(()=>{"use strict";function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var t=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this._options=e}var n,r;return n=t,(r=[{key:"getUser",value:function(){return fetch("".concat(this._options.baseUrl,"/users/me"),{headers:this._options.headers})}},{key:"getInitialCards",value:function(){return fetch("".concat(this._options.baseUrl,"/cards"),{headers:this._options.headers})}},{key:"patchAvatar",value:function(e){var t=e.avatar;return fetch("".concat(this._options.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:this._options.headers,body:JSON.stringify({avatar:t})})}},{key:"patchUser",value:function(e){var t=e.name,n=e.about;return fetch("".concat(this._options.baseUrl,"/users/me"),{method:"PATCH",headers:this._options.headers,body:JSON.stringify({name:t,about:n})})}},{key:"deleteCard",value:function(e){return fetch("".concat(this._options.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:this._options.headers})}},{key:"deleteLike",value:function(e){return fetch("".concat(this._options.baseUrl,"/cards/").concat(e,"/likes"),{method:"DELETE",headers:this._options.headers})}},{key:"putLike",value:function(e){return fetch("".concat(this._options.baseUrl,"/cards/").concat(e,"/likes"),{method:"PUT",headers:this._options.headers})}},{key:"postCard",value:function(e){var t=e.name,n=e.link;return fetch("".concat(this._options.baseUrl,"/cards"),{method:"POST",headers:this._options.headers,body:JSON.stringify({name:t,link:n})})}}])&&e(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),t}(),n={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__submit",inactiveButtonClass:"form__save_inactive",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"},r="#card-template",o=".element";function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=function(){function e(t){var n,r,o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r=function(e){(e.target.classList.contains(o._openPopup)||e.target.classList.contains(o._closePopup))&&o.close(o._popup)},(n="_handleButtonClose")in this?Object.defineProperty(this,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):this[n]=r,this._popup=document.querySelector(t),this._handleEscClose=this._handleEscClose.bind(this),this._openPopup="popup_active",this._closePopup="popup__close"}var t,n;return t=e,(n=[{key:"_handleEscClose",value:function(e){"Escape"===e.key&&this.close()}},{key:"setEventListeners",value:function(){document.addEventListener("keydown",this._handleEscClose),this._popup.addEventListener("mousedown",this._handleButtonClose)}},{key:"open",value:function(){this.setEventListeners(),this._popup.classList.add(this._openPopup)}},{key:"close",value:function(){this._popup.classList.remove(this._openPopup),this._popup.removeEventListener("mousedown",this._handleButtonClose),document.removeEventListener("keydown",this._handleEscClose)}}])&&i(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(){return s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=l(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},s.apply(this,arguments)}function l(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=h(e)););return e}function f(e,t){return f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},f(e,t)}function p(e,t){if(t&&("object"===c(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function h(e){return h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},h(e)}var y=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&f(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=h(r);if(o){var n=h(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return p(this,e)});function a(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=i.call(this,t))._popup=document.querySelector(t),n._yes=n._popup.querySelector(".form__delete"),n._deleteCard=function(t){t.preventDefault(),e(),n.close()},n}return t=a,(n=[{key:"close",value:function(){s(h(a.prototype),"close",this).call(this),this._yes.removeEventListener("click",this._deleteCard)}},{key:"setEventListeners",value:function(){s(h(a.prototype),"setEventListeners",this).call(this),this._yes.addEventListener("click",this._deleteCard)}}])&&u(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(a);function _(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var d=function(){function e(t){var n=t.item,r=t.cardTemplate,i=t.handleCardClick,a=t.api;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._item=n,this._cardTemplate=r,this._cardLike="element__like_checked",this._element=o,this._elementLike=".element__like",this._elementRemove=".element__remove",this._elementImage=".element__image",this._handleCardClick=i,this._api=a}var t,n;return t=e,(n=[{key:"_setCounter",value:function(e){this._counter.textContent=e}},{key:"_likeToggle",value:function(e){var t=this;e.target.classList.contains(this._cardLike)?this._api.deleteLike(this._item._id).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return t._setCounter(e.likes.length)})).catch((function(e){console.log(e)})):this._api.putLike(this._item._id).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return t._setCounter(e.likes.length)})).catch((function(e){console.log(e)})),e.target.classList.toggle(this._cardLike)}},{key:"_openModal",value:function(e){var t=this;new y((function(n){t._api.deleteCard(t._item._id).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)})),e.target.closest(t._element).remove(),t._element=null}),".popup_type_delete").open()}},{key:"_setEventListener",value:function(e,t){var n=this,r=e.querySelector(this._elementLike),o=e.querySelector(this._elementRemove);this._counter=e.querySelector(".element__counter"),this._counter.textContent=0,Array.isArray(this._item.likes)&&(this._setCounter(this._item.likes.length),this._item.likes.some((function(e){return e._id===n._item.owner._id}))&&r.classList.toggle(this._cardLike)),o.addEventListener("click",(function(e){return n._openModal(e)})),r.addEventListener("click",(function(e){return n._likeToggle(e)})),t.addEventListener("click",(function(){return n._handleCardClick(n._item)}))}},{key:"_getTemplateCard",value:function(){return document.querySelector(this._cardTemplate).content.querySelector(o).cloneNode(!0)}},{key:"createCard",value:function(){var e=this._getTemplateCard();e.querySelector(".element__name").textContent=this._item.name;var t=e.querySelector(this._elementImage);return t.src=this._item.link,t.alt=this._item.name,this._setEventListener(e,t),e}}])&&_(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var v=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._config=t,this._formElement=n}var t,n;return t=e,(n=[{key:"enableValidation",value:function(){this._formElement.addEventListener("submit",(function(e){e.preventDefault()})),this._setEventListeners(this._formElement)}},{key:"resetValidation",value:function(){var e=this;this._formElement.reset();var t=Array.from(this._formElement.querySelectorAll(".".concat(this._config.errorClass))),n=Array.from(this._formElement.querySelectorAll(this._config.inputSelector)),r=this._formElement.querySelector(this._config.submitButtonSelector);this._toggleButtonState(n,r),t.forEach((function(t){e._hideError(t)}))}},{key:"_hideError",value:function(e){e.textContent=""}},{key:"_setEventListeners",value:function(e){var t=this,n=Array.from(e.querySelectorAll(this._config.inputSelector)),r=e.querySelector(this._config.submitButtonSelector);this._toggleButtonState(n,r),n.forEach((function(o){o.addEventListener("input",(function(){!function(e,n){t._checkInputValidity(e,n)}(e,o),function(e,n){t._toggleButtonState(e,n)}(n,r)}))}))}},{key:"_toggleButtonState",value:function(e,t){this._hasInvalidInput(e)?(t.classList.add(this._config.inactiveButtonClass),t.disabled=!0):(t.classList.remove(this._config.inactiveButtonClass),t.disabled=!1)}},{key:"_hasInvalidInput",value:function(e){return e.some((function(e){return!e.validity.valid}))}},{key:"_showInputError",value:function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(this._config.inputErrorClass),r.textContent=n,r.classList.add(this._config.errorClass)}},{key:"_hideInputError",value:function(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(this._config.inputErrorClass),n.classList.remove(this._config.errorClass),n.textContent=""}},{key:"_checkInputValidity",value:function(e,t){t.validity.valid?this._hideInputError(e,t):this._showInputError(e,t,t.validationMessage)}}])&&m(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var g=function(){function e(t,n){var r=t.items,o=t.renderer;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._items=r,this._renderer=o,this._container=document.querySelector(n)}var t,n;return t=e,(n=[{key:"_clear",value:function(){this._container.innerHTML=""}},{key:"render",value:function(){var e=this;this._clear(),this._items.reverse().forEach((function(t){e._renderer(t)}))}},{key:"addItem",value:function(e){this._container.prepend(e)}}])&&b(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function k(e){return k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},k(e)}function w(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function S(){return S="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=E(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},S.apply(this,arguments)}function E(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=O(e)););return e}function C(e,t){return C=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},C(e,t)}function j(e,t){if(t&&("object"===k(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function O(e){return O=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},O(e)}var P=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&C(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=O(r);if(o){var n=O(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return j(this,e)});function a(e){var t,n=e.submit,r=e.popupSelector;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this,r))._popupSelector=r,t._popup=document.querySelector(t._popupSelector),t._submit=function(e,r){n(e,t._getInputValues()),t.close()},t._popup=document.querySelector(t._popupSelector),t._form=t._popup.querySelector(".form"),t}return t=a,(n=[{key:"close",value:function(){S(O(a.prototype),"close",this).call(this),this._form.reset(),this._popup.removeEventListener("submit",this._submit)}},{key:"_getInputValues",value:function(){return this._form.elements}},{key:"setEventListeners",value:function(){S(O(a.prototype),"setEventListeners",this).call(this),this._popup.addEventListener("submit",this._submit)}}])&&w(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(a);function L(e){return L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},L(e)}function q(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function T(){return T="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=R(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},T.apply(this,arguments)}function R(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=B(e)););return e}function I(e,t){return I=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},I(e,t)}function U(e,t){if(t&&("object"===L(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function B(e){return B=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},B(e)}var x=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&I(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=B(r);if(o){var n=B(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return U(this,e)});function a(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=i.call(this,t))._card=e,n._popup=document.querySelector(t),n._slideImage=".slide__image",n._slideName=".slide__name",n}return t=a,(n=[{key:"open",value:function(){T(B(a.prototype),"open",this).call(this),this._image=this._popup.querySelector(this._slideImage),this._popup.querySelector(this._slideName).textContent=this._card.name,this._image.src=this._card.link,this._image.alt=this._card.name}}])&&q(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(a);function A(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var D=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._profileName=document.querySelector(t.name),this._profileProfession=document.querySelector(t.about),this._avatar=document.querySelector(t.avatar)}var t,n;return t=e,(n=[{key:"getUserInfo",value:function(){return{name:this._profileName.textContent,profession:this._profileProfession.textContent}}},{key:"setUserInfo",value:function(e){this._profileName.textContent=e.name,this._profileProfession.textContent=e.about}},{key:"setUserAvatar",value:function(e){this._avatar.src=e.avatar}}])&&A(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}(),V=document.querySelector(".form_type_edit-avatar"),N=document.querySelector(".form_type_edit"),M=document.querySelector(".profile__image"),H=document.querySelector(".form_type_add"),J=document.querySelector(".profile__add"),z=document.querySelector(".profile__edit"),F=N.querySelector(".form__input_type_name"),G=N.querySelector(".form__input_type_profession"),K=null,Q=new t({baseUrl:"https://mesto.nomoreparties.co/v1/cohort36",headers:{authorization:"fcfa5c3a-c07d-49f3-a47d-0099ff285712","Content-Type":"application/json"}}),W=new v(n,V),X=new v(n,N),Y=new v(n,H),Z=new D({name:".profile__name",about:".profile__profession",avatar:".avatar"});W.enableValidation(),X.enableValidation(),Y.enableValidation();var $=function(e){new x(e,".popup_type_slide").open()};function ee(e,t){t.querySelector(".form__save").innerHTML=e?"Сохранение...":"Сохранить"}var te=new P({submit:function(e,t){e.preventDefault(),ee(!0,H);var n=t.name,o=t.link,i={name:n.value,link:o.value};Q.postCard(i).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){var t=new d({item:e,cardTemplate:r,handleCardClick:$,api:Q}).createCard();K.addItem(t)})).catch((function(e){console.log(e)})).finally(ee(!1,H))},popupSelector:".popup_type_add"}),ne=new P({submit:function(e,t){e.preventDefault(),ee(!0,N);var n=t.name,r=t.profession,o={name:n.value,about:r.value};Q.patchUser({name:o.name,about:o.about}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return Z.setUserInfo(e)})).catch((function(e){console.log(e)})).finally(ee(!1,N))},popupSelector:".popup_type_edit"}),re=new P({submit:function(e,t){e.preventDefault(),ee(!0,V);var n=t.avatar;Q.patchAvatar({avatar:n.value}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return Z.setUserAvatar(e)})).catch((function(e){console.log(e)})).finally(ee(!1,V))},popupSelector:".popup_type_edit-avatar"});Q.getInitialCards().then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){(K=new g({items:e,renderer:function(e){var t=new d({item:e,cardTemplate:r,handleCardClick:$,api:Q}).createCard();K.addItem(t)}},".elements")).render()})).catch((function(e){console.log(e)})),z.addEventListener("click",(function(){X.resetValidation(),Q.getUser().then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){F.value=e.name,G.value=e.about,ne.open()})).catch((function(e){console.log(e)}))})),J.addEventListener("click",(function(){Y.resetValidation(),te.open()})),M.addEventListener("click",(function(){W.resetValidation(),re.open()})),Q.getUser().then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){Z.setUserInfo({name:e.name,about:e.about,avatar:e.avatar}),Z.setUserAvatar({name:e.name,about:e.about,avatar:e.avatar})})).catch((function(e){console.log(e)}))})();